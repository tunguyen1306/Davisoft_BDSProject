@using System.Configuration
@using System.Web.UI.WebControls
@using WebBDS_Project.Models
@{

    davisoft_bdsprojectEntities db = new davisoft_bdsprojectEntities();
    int from = ViewBag.from;
    int page = ViewBag.page;
    int view = ViewBag.view;
    int count = 0;
    var states = (from a in db.states join b in db.statetexts on a.state_id equals b.id where b.language_id == "vi" && a.Status == 1 select new { Id = a.state_id, Name = b.text }).ToList();
}

@{
    var typeVip = db.bdsnewstypes.Where(T => T.Active == 1 && T.CodeNewsType == "TDB").FirstOrDefault();
}
<ul class="list_work">
    @if (typeVip != null)
    {
        var query = db.bdsnews.Where(A => A.Active == 1 && A.Status == 1 && A.IdTypeNewsCuurent == typeVip.Id);      
        var ListNews = query.OrderByDescending(T => T.FromCreateNews).Skip(from).Take(view).ToList();
        count = query.Count();
        foreach (var news in ListNews)
        {
            <li>
                <div class="grid_3">
                    <a href="@Url.Action("Detail","Default",new { id=1})">
                        <img src="@ConfigurationManager.AppSettings["adminDomain"]@(db.bdsemployerinformations.Where(T=>T.IdAccount==news.IdAcount).FirstOrDefault().UrlImage)" alt="1">
                        <p class="vip">
                            <i class="fa fa-star"></i>
                            <span>VIP</span>
                        </p>
                    </a>
                </div>
                <div class="grid_9 omega">
                    <h2><a href="@Url.Action("Detail","Default",new { id=1})">@( db.bdscareers.Where(T => T.Id == news.IdTypeNewsCuurent).FirstOrDefault().Name) <span>@(db.bdsemployerinformations.Where(T => T.IdAccount == news.IdAcount).FirstOrDefault().Name)</span></a></h2>
                    <p><i class="fa fa-map-marker"></i>@(states.Where(T => T.Id == news.AddressWork).FirstOrDefault().Name)</p>
                    <div>
                        <p class="grid_6"><i class="fa fa-usd"></i>Lương: Từ <span>@(news.FromSalary) - @(news.ToSalary)</span> triêu </p>
                        <p class="grid_6 omega time">Mã tin: <span class="color2">P@(news.Id.ToString("000000"))</span> <i class="fa fa-clock-o"></i> @(news.FromCreateNews.Value.ToString("dd/MM/yyyy"))</p>
                    </div>
                </div>
            </li>
        }
    }


    <li class="page">
        <div class="page_links">
            <span>Trang</span>
            @if (count > 0)
{
    var p = Math.Ceiling((double)count / view);
    for (int i = 1; i <= (int)p; i++)
    {
        <a data-ref='@(page != i ? "" + Url.Action("TinDacBiet", "Default", new { from = (i -1) * view, page = i, view = view }) + "" : "")' style="cursor: pointer" onclick="loadPageFrom(this);" @(page == i ? " class=active" : "")>@i</a>
    }
}
            <a class="nextPage" onclick="loadPageFromNext(this);">Tiếp</a>
        </div>
        <div class="more">
            <i class="fa fa-angle-double-right" aria-hidden="true"></i><a href="@Url.Action("Detail","Default",new { id=1})">Xem thêm</a>
        </div>
    </li>
</ul>
<style>
    a.active {
        cursor: auto;
    }
</style>
<script>
    function loadPageFrom(el) {
        var url = $(el).attr('data-ref');
        if (url!="") {
            $.get(url, function (data) {
                $(el).parents('ul.list_work').eq(0).html($(data).html());

            });
        }
        
    }
    function loadPageFromNext(el) {
     
        var elNext = $(el).parents('.page_links').eq(0).find('a.active').next();
        if (!$(elNext).hasClass('nextPage')) {
            $(elNext).click();
        }

    }
  

</script>